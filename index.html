<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 그림일기</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="diary-container">
        <header class="diary-header">
            <h1>그림일기</h1>
            <div class="date-input">
                <label for="diary-date">날짜:</label>
                <input type="date" id="diary-date">
                <label for="weather-select">날씨:</label>
                <select id="weather-select">
                    <option value="sunny">맑음 ☀️</option>
                    <option value="cloudy">구름 ☁️</option>
                    <option value="rainy">비 ☔</option>
                    <option value="snowy">눈 ☃️</option>
                </select>
            </div>
        </header>

        <section class="image-section">
            <div class="drawing-controls">
                <div class="tool-group">
                    <label>도구:</label>
                    <button id="tool-brush" class="tool-btn active">✏️ 붓</button>
                    <button id="tool-eraser" class="tool-btn">🧼 지우개</button>
                    <button id="tool-fill" class="tool-btn">🪣 채우기</button>
                </div>
                <div class="tool-group">
                    <label>크기:</label>
                    <input type="range" id="brush-size" min="1" max="20" value="5">
                </div>
                <div class="tool-group">
                    <label>색상:</label>
                    <div class="color-palette" id="color-palette">
                        <!-- Colors generated by JS -->
                    </div>
                    <input type="color" id="custom-color" value="#000000" style="width:30px; height:30px; border:none; padding:0; background:none;">
                </div>
                <div class="tool-group action-group">
                    <button id="btn-upload-trigger">📷 사진 올리기</button>
                    <button id="btn-clear-canvas">📄 새 종이</button>
                </div>
            </div>
            
            <div class="canvas-container">
                <div class="upload-area" id="upload-area">
                    <p>이곳에 그림을 그리거나<br>사진을 올려보세요!</p>
                </div>
                <div id="brush-guide"></div>
                <canvas id="drawing-canvas"></canvas>
            </div>
            
            <input type="file" id="image-upload" accept="image/*" style="display: none;">
            <!-- Hidden original image for processing -->
            <img id="source-image" style="display: none;">
        </section>

        <section class="text-section">
            <div id="diary-grid-display"></div>
            <textarea id="diary-text" placeholder="오늘의 일기를 써보세요..."></textarea>
        </section>

        <footer class="diary-footer">
            <button id="reset-btn">지우개 (다시하기)</button>
            <button id="save-btn">일기 저장하기</button>
        </footer>
    </div>

    <!-- SVG Filters for Crayon/Paper Effect -->
    <svg style="display: none;">
        <defs>
            <filter id="crayon-filter">
                <!-- 1. Create noise for rough texture -->
                <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch" result="noise"/>
                
                <!-- 2. Displace the source image using the noise -->
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" xChannelSelector="R" yChannelSelector="G" result="displaced"/>
                
                <!-- 3. Enhance contrast to mimic wax/crayon -->
                <feComponentTransfer in="displaced" result="high-contrast">
                    <feFuncR type="linear" slope="1.2" intercept="-0.1"/>
                    <feFuncG type="linear" slope="1.2" intercept="-0.1"/>
                    <feFuncB type="linear" slope="1.2" intercept="-0.1"/>
                </feComponentTransfer>
                
                <!-- 4. Blend with noise again for paper texture -->
                <feBlend in="high-contrast" in2="noise" mode="multiply" result="textured"/>
            </filter>
        </defs>
    </svg>

    <script src="main.js" type="module"></script>
</body>
</html>